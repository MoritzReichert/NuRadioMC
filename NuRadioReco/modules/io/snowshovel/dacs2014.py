def enum(**enums):
    return type('Enum', (), enums)

dacOffset = 1475

sstThrshCals = {
    102: {
        0: {'high': {'b': 24.646341463414686, 'm': 0.646341463414634},
            'low': {'b': -2.3786664121652326, 'm': 0.638830565629573}},
        1: {'high': {'b': 13.30923344947749, 'm': 0.6663763066202086},
            'low': {'b': -3.7978940001273007, 'm': 0.6562639180505184}},
        2: {'high': {'b': 7.104529616724952, 'm': 0.6759581881533094},
            'low': {'b': -0.021473563657242956, 'm': 0.671025004771903}},
        3: {'high': {'b': 14.020034843205819, 'm': 0.662891986062717},
            'low': {'b': -2.7978940001272896, 'm': 0.6562639180505184}},
    },
    104: {
        0: {'high': {'b': 10.0078397212545, 'm': 0.6506968641114979},
            'low': {'b': 8.265731373671818, 'm': 0.6310046446522873}},
        1: {'high': {'b': 41.790940766550946, 'm': 0.6480836236933785},
            'low': {'b': 18.266526690844277, 'm': 0.6431889037348093}},
        2: {'high': {'b': 9.453832752613453, 'm': 0.668118466898954},
            'low': {'b': 16.68734491315134, 'm': 0.6501240694789081}},
        3: {'high': {'b': 40.152439024390446, 'm': 0.6524390243902433},
            'low': {'b': 15.266526690844277, 'm': 0.6431889037348093}},
    },
    105: {
        0: {'high': {'b': 6.718641114982817, 'm': 0.6472125435540063},
            'low': {'b': 7.266526690844254, 'm': 0.6431889037348093}},
        1: {'high': {'b': 15.381533101045319, 'm': 0.6672473867595818},
            'low': {'b': -3.6022459756951313, 'm': 0.6535916523509575}},
        2: {'high': {'b': 17.309233449477503, 'm': 0.6663763066202086},
            'low': {'b': 8.557708214035738, 'm': 0.6640898390278043}},
        3: {'high': {'b': 9.020034843205796, 'm': 0.662891986062717},
            'low': {'b': 6.202105999872711, 'm': 0.6562639180505184}},
    },
    107: {
        0: {'high': {'b': 11.357142857142989, 'm': 0.6428571428571425},
            'low': {'b': 6.200515365527717, 'm': 0.6318953998854743}},
        1: {'high': {'b': 13.658536585366, 'm': 0.6585365853658532},
            'low': {'b': 16.556912896863214, 'm': 0.6519055799452821}},
        2: {'high': {'b': 9.092334494773635, 'm': 0.6637630662020902},
            'low': {'b': -2.7318826748107634, 'm': 0.6675574218998536}},
        3: {'high': {'b': 5.369337979094295, 'm': 0.6550522648083617},
            'low': {'b': 9.911719793853466, 'm': 0.6475472418400449}},
    },
    108: {
        0: {'high': {'b': 7.718641114982796, 'm': 0.6472125435540063},
            'low': {'b': -0.6690526181841382, 'm': 0.6301138894191003}},
        1: {'high': {'b': 12.441637630662441, 'm': 0.6559233449477339},
            'low': {'b': 3.8465037857097157, 'm': 0.6484379970732328}},
        2: {'high': {'b': 17.658536585366274, 'm': 0.6585365853658524},
            'low': {'b': 2.2005153655274428, 'm': 0.6318953998854734}},
        3: {'high': {'b': 3.6585365853659892, 'm': 0.6585365853658532},
            'low': {'b': 7.266526690844254, 'm': 0.6431889037348093}},
    },
    109: {
        0: {'high': {'b': 6.297038327526139, 'm': 0.6541811846689896},
            'low': {'b': -6.08828020614625, 'm': 0.6475472418400458}},
        1: {'high': {'b': 14.658536585366274, 'm': 0.6585365853658524},
            'low': {'b': 10.267322008016768, 'm': 0.6553731628173315}},
        2: {'high': {'b': 12.94773519163764, 'm': 0.662020905923345},
            'low': {'b': 6.9125151110262095, 'm': 0.6597315009225678}},
        3: {'high': {'b': 2.3092334494775004, 'm': 0.6663763066202086},
            'low': {'b': -9.311859769676204, 'm': 0.6623083285614302}},
    },
    110: {
        0: {'high': {'b': 9.224738675958333, 'm': 0.6533101045296164},
            'low': {'b': 7.91171979385374, 'm': 0.6475472418400458}},
        1: {'high': {'b': 13.22473867595864, 'm': 0.6533101045296154},
            'low': {'b': 2.78208309473814, 'm': 0.6615130113889418}},
        2: {'high': {'b': 13.020034843205806, 'm': 0.662891986062717},
            'low': {'b': -3.442291785964262, 'm': 0.6640898390278043}},
        3: {'high': {'b': 12.586236933798151, 'm': 0.6576655052264802},
            'low': {'b': 4.846503785709727, 'm': 0.6484379970732328}},
    },
    111: {
        0: {'high': {'b': 21.863240418118824, 'm': 0.6489547038327516},
            'low': {'b': 19.84650378570973, 'm': 0.6484379970732328}},
        1: {'high': {'b': 14.959930313589002, 'm': 0.674216027874564},
            'low': {'b': 9.426480880575145, 'm': 0.6536870904116561}},
        2: {'high': {'b': 17.88763066202113, 'm': 0.6733449477351909},
            'low': {'b': 3.8472991028821966, 'm': 0.6606222561557549}},
        3: {'high': {'b': 0.5261324041813227, 'm': 0.6689895470383271},
            'low': {'b': 19.847299102882207, 'm': 0.6606222561557549}},
    },
    112: {
        0: {'high': {'b': 20.71864111498281, 'm': 0.6472125435540063}, 
            'low': {'b': 4.846503785709727, 'm': 0.6484379970732328}},
        1: {'high': {'b': 1.3815331010456233, 'm': 0.6672473867595808},
            'low': {'b': -1.1527008971181212, 'm': 0.6606222561557539}},
        2: {'high': {'b': 10.670731707317307, 'm': 0.6707317073170724},
            'low': {'b': 10.557708214035728, 'm': 0.6640898390278043}},
        3: {'high': {'b': 20.369337979094297, 'm': 0.6550522648083617},
            'low': {'b': 11.2021059998727, 'm': 0.6562639180505184}},
    },
    113: {
        0: {'high': {'b': 16.297038327526153, 'm': 0.6541811846689896},
            'low': {'b': 2.201310682700186, 'm': 0.6440796589679963}},
        1: {'high': {'b': 18.020034843205796, 'm': 0.662891986062717},
            'low': {'b': 7.8472991028818795, 'm': 0.6606222561557539}},
        2: {'high': {'b': 16.321428571428797, 'm': 0.6785714285714278},
            'low': {'b': -0.7970986829547869, 'm': 0.6684481771330406}},
        3: {'high': {'b': 17.309233449477503, 'm': 0.6663763066202086},
            'low': {'b': -5.377075777820238, 'm': 0.6631990837946172}},
    },
    114: {
        0: {'high': {'b': 13.28484320557514, 'm': 0.6419860627177694},
            'low': {'b': -0.37866641216521046, 'm': 0.638830565629573}},
        1: {'high': {'b': 5.020034843205817, 'm': 0.662891986062717},
            'low': {'b': -2.1542915314627984, 'm': 0.6362537379907106}},
        2: {'high': {'b': 17.381533101045306, 'm': 0.6672473867595818},
            'low': {'b': -12.733473309155737, 'm': 0.6431889037348093}},
        3: {'high': {'b': 7.803135888501941, 'm': 0.6602787456445987},
            'low': {'b': 2.976935801997763, 'm': 0.6466564866068587}},
    },
    201: { # Added New Manual Threshold Calibration Equations -Manuel P.
    	0: {'high': {'b': -971.673, 'm': 0.040830},
     	   'low': {'b': -967.541, 'm': 0.040867}},
    	1: {'high': {'b': -938.375, 'm': 0.040563},
	   'low': {'b': -976.519, 'm': 0.041066}},
    	2: {'high': {'b': -964.488, 'm': 0.040818},
    	    'low': {'b': -961.972, 'm': 0.040794}},
    	3: {'high': {'b': -974.053, 'm': 0.040891},
    	    'low': {'b': -968.471, 'm': 0.040879}},
    	4: {'high': {'b': -943.018, 'm': 0.040550},
    	    'low': {'b': -969.908, 'm': 0.041106}},
    	5: {'high': {'b': -938.776, 'm': 0.040038},
    	    'low': {'b': -972.704, 'm': 0.041057}},
    	6: {'high': {'b': -944.372, 'm': 0.040162},
    	    'low': {'b': -966.208, 'm': 0.040962}},
    	7: {'high': {'b': -944.026, 'm': 0.040123},
    	    'low': {'b': -967.51, 'm': 0.040903}},
    },
    202: {
        0: {'high': {'b': -924.1, 'm': 0.0392},
            'low': {'b': -913.7, 'm': 0.03886}},
        1: {'high': {'b': -918.6, 'm': 0.03924},
            'low': {'b': -902.6, 'm': 0.03884}},
        2: {'high': {'b': -928.9, 'm': 0.03937},
            'low': {'b': -922.9, 'm': 0.03898}},
        3: {'high': {'b': -919.2, 'm': 0.03924},
            'low': {'b': -914.1, 'm': 0.03898}},
        4: {'high': {'b': -925, 'm': 0.03991},
            'low': {'b': -910, 'm': 0.03902}},
        5: {'high': {'b': -934.1, 'm': 0.03951},
            'low': {'b': -913.3, 'm': 0.03883}},
        6: {'high': {'b': -926.8, 'm': 0.03968},
            'low': {'b': -901.8, 'm': 0.03881}},
        7: {'high': {'b': -921.2, 'm': 0.03922},
            'low': {'b': -918.5, 'm': 0.03901}},
    },
    203: {
        0: {'high': {'b': -936.7, 'm': 0.03948},
            'low': {'b': -925, 'm': 0.03926}},
        1: {'high': {'b': -875, 'm': 0.03759},
            'low': {'b': -914.5, 'm': 0.03978}},
        2: {'high': {'b': -932.4, 'm': 0.03934},
            'low': {'b': -923.4, 'm': 0.03914}},
        3: {'high': {'b': -934.1, 'm': 0.03941},
            'low': {'b': -923.4, 'm': 0.03925}},
        4: {'high': {'b': -939.2, 'm': 0.03956},
            'low': {'b': -914.7, 'm': 0.03902}},
        5: {'high': {'b': -932.9, 'm': 0.03941},
            'low': {'b': -923.1, 'm': 0.03934}},
        6: {'high': {'b': -936.7, 'm': 0.03938},
            'low': {'b': -921.3, 'm': 0.03923}},
        7: {'high': {'b': -916.5, 'm': 0.0392},
            'low': {'b': -916.8, 'm': 0.03899}},
    },
    204: {
        0: {'high': {'b': -936, 'm': 0.03947},
            'low': {'b': -903.5, 'm': 0.03816}},
        1: {'high': {'b': -942.6, 'm': 0.04007},
            'low': {'b': -927.9, 'm': 0.03893}},
        2: {'high': {'b': -937.9, 'm': 0.03947},
            'low': {'b': -900.6, 'm': 0.03814}},
        3: {'high': {'b': -948.4, 'm': 0.03959},
            'low': {'b': -921.7, 'm': 0.0386}},
        4: {'high': {'b': -923.1, 'm': 0.03935},
            'low': {'b': -914.8, 'm': 0.03868}},
        5: {'high': {'b': -920.8, 'm': 0.03932},
            'low': {'b': -906, 'm': 0.03835}},
        6: {'high': {'b': -916.9, 'm': 0.0394},
            'low': {'b': -892.8, 'm': 0.03734}},
        7: {'high': {'b': -932.5, 'm': 0.03946},
            'low': {'b': -931.8, 'm': 0.03955}},
    },
    205: {
        0: {'high': {'b': -927.8, 'm': 0.03976},
            'low': {'b': -916.4, 'm': 0.03899}},
        1: {'high': {'b': -924.3, 'm': 0.03937},
            'low': {'b': -929, 'm': 0.03921}},
        2: {'high': {'b': -967.9, 'm': 0.04044},
            'low': {'b': -901.1, 'm': 0.03872}},
        3: {'high': {'b': -931.3, 'm': 0.03934},
            'low': {'b': -916.7, 'm': 0.03898}},
        4: {'high': {'b': -935.9, 'm': 0.03949},
            'low': {'b': -918.4, 'm': 0.03887}},
        5: {'high': {'b': -921.8, 'm': 0.03925},
            'low': {'b': -925.5, 'm': 0.03922}},
        6: {'high': {'b': -930.7, 'm': 0.03936},
            'low': {'b': -929, 'm': 0.03904}},
        7: {'high': {'b': -926.5, 'm': 0.03939},
            'low': {'b': -915.5, 'm': 0.03896}},
    },
    207: {
        0: {'high': {'b': -921.9, 'm': 0.03917},
            'low': {'b': -890.1, 'm': 0.03817}},
        1: {'high': {'b': -921.9, 'm': 0.03931},
            'low': {'b': -929.5, 'm': 0.03916}},
        2: {'high': {'b': -931.5, 'm': 0.04027},
            'low': {'b': -931.5, 'm': 0.03915}},
        3: {'high': {'b': -935.5, 'm': 0.04027},
            'low': {'b': -902.8, 'm': 0.03862}},
        4: {'high': {'b': -931.5, 'm': 0.03938},
            'low': {'b': -910.3, 'm': 0.03889}},
        5: {'high': {'b': -923.2, 'm': 0.03928},
            'low': {'b': -909.8, 'm': 0.03893}},
        6: {'high': {'b': -934.9, 'm': 0.03959},
            'low': {'b': -911.6, 'm': 0.03889}},
        7: {'high': {'b': -932.9, 'm': 0.0393},
            'low': {'b': -918.7, 'm': 0.03892}},
    },
    208: {
        0: {'high': {'b': -924.8, 'm': 0.0392},
            'low': {'b': -921.5, 'm': 0.03904}},
        1: {'high': {'b': -917.8, 'm': 0.03931},
            'low': {'b': -916, 'm': 0.03932}},
        2: {'high': {'b': -920, 'm': 0.03913},
            'low': {'b': -920.5, 'm': 0.03942}},
        3: {'high': {'b': -926.8, 'm': 0.03942},
            'low': {'b': -918.4, 'm': 0.03886}},
        4: {'high': {'b': -921.1, 'm': 0.03925},
            'low': {'b': -916, 'm': 0.03901}},
        5: {'high': {'b': -923.6, 'm': 0.03929},
            'low': {'b': -910.8, 'm': 0.03891}},
        6: {'high': {'b': -925.2, 'm': 0.03936},
            'low': {'b': -914, 'm': 0.03902}},
        7: {'high': {'b': -927.8, 'm': 0.03933},
            'low': {'b': -915.7, 'm': 0.03903}},
    }
}

def getDac(board, ch, Vth):
    if (abs(Vth)<1.0):
        Vth *= 1000. # V to mV
    hilo = None
    if (Vth>0):
        hilo = 'high'
    else:
        hilo = 'low'
    cpars = sstThrshCals[board][ch][hilo]
    d = (Vth - cpars['b']) / cpars['m']
    d = int(round(d))
    if(board < 200):
        d += dacOffset
    return d

def getVth(board, ch, dac, hilo):
    cpars = sstThrshCals[board][ch][hilo]
    temp_dac_offset = dacOffset
    if(board >= 200):
        temp_dac_offset = 0
    v = ( cpars['m'] * (dac - temp_dac_offset) ) + cpars['b']
    return v


